# TestBridge 구현 준비 문서

---

# ③ 환경변수 목록 (.env)

## 백엔드 (apps/server/.env)

```bash
# ── 서버 ──
NODE_ENV=development
PORT=4000
API_PREFIX=v1

# ── 데이터베이스 ──
DATABASE_URL=postgresql://testbridge:password@localhost:5432/testbridge?schema=public

# ── Redis ──
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# ── JWT ──
JWT_SECRET=your-256-bit-secret-key-here
JWT_ACCESS_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=14d

# ── Google OAuth ──
GOOGLE_CLIENT_ID=xxxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-xxxx
GOOGLE_REDIRECT_URI=http://localhost:3000/callback/google

# ── 카카오 OAuth ──
KAKAO_CLIENT_ID=xxxx
KAKAO_CLIENT_SECRET=xxxx
KAKAO_REDIRECT_URI=http://localhost:3000/callback/kakao

# ── 네이버 OAuth ──
NAVER_CLIENT_ID=xxxx
NAVER_CLIENT_SECRET=xxxx
NAVER_REDIRECT_URI=http://localhost:3000/callback/naver

# ── 토스페이먼츠 ──
TOSS_CLIENT_KEY=test_ck_xxxx
TOSS_SECRET_KEY=test_sk_xxxx
TOSS_API_URL=https://api.tosspayments.com

# ── AWS ──
AWS_REGION=ap-northeast-2
AWS_ACCESS_KEY_ID=xxxx
AWS_SECRET_ACCESS_KEY=xxxx

# ── AWS S3 ──
S3_BUCKET=testbridge-dev
S3_CDN_URL=https://cdn.testbridge.kr

# ── AWS SES ──
SES_FROM_EMAIL=no-reply@testbridge.kr

# ── AWS SQS ──
SQS_EMAIL_QUEUE_URL=https://sqs.ap-northeast-2.amazonaws.com/xxxx/testbridge-email

# ── Firebase (FCM 푸시) ──
FCM_PROJECT_ID=testbridge-xxxx
FCM_PRIVATE_KEY=xxxx
FCM_CLIENT_EMAIL=firebase-adminsdk@testbridge.iam.gserviceaccount.com

# ── 암호화 ──
ENCRYPTION_KEY=32-byte-hex-key-for-aes-256

# ── CORS ──
CORS_ORIGIN=http://localhost:3000

# ── Rate Limit ──
THROTTLE_TTL=60
THROTTLE_LIMIT=100
```

## 프론트엔드 (apps/web/.env)

```bash
NEXT_PUBLIC_API_URL=http://localhost:4000/v1
NEXT_PUBLIC_GOOGLE_CLIENT_ID=xxxx.apps.googleusercontent.com
NEXT_PUBLIC_KAKAO_CLIENT_ID=xxxx
NEXT_PUBLIC_NAVER_CLIENT_ID=xxxx
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_xxxx
NEXT_PUBLIC_CDN_URL=https://cdn.testbridge.kr
```

## docker-compose.yml (로컬 개발)

```yaml
version: '3.8'
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_DB: testbridge
      POSTGRES_USER: testbridge
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  pgdata:
```

---

# ④ Enum/상수 통합 정의

## packages/shared/src/constants/plans.ts

```typescript
export const PLAN_CONFIG = {
  FREE: {
    price: 0,
    maxApps: 1,
    maxTesters: 20,
    feeRate: 0.15,
    testType: ['CREDIT_EXCHANGE'],
    boostLimit: 0, // 월간
  },
  BASIC: {
    price: 19900,
    maxApps: 10,
    maxTesters: 25,
    feeRate: 0.10,
    testType: ['PAID_REWARD', 'CREDIT_EXCHANGE'],
    boostLimit: 1,
  },
  PRO: {
    price: 49900,
    maxApps: 50,
    maxTesters: 30,
    feeRate: 0.07,
    testType: ['PAID_REWARD', 'CREDIT_EXCHANGE'],
    boostLimit: 3,
  },
  ENTERPRISE: {
    price: 99900,
    maxApps: 100,
    maxTesters: 40,
    feeRate: 0.05,
    testType: ['PAID_REWARD', 'CREDIT_EXCHANGE'],
    boostLimit: Infinity,
  },
} as const;
```

## packages/shared/src/constants/rewards.ts

```typescript
export const REWARD_CONFIG = {
  CREDIT: {
    TEST_COMPLETED: 20,    // 테스트 완료 시 크레딧
    FEEDBACK_BONUS: 10,     // 피드백 제출 보너스
    APP_REGISTER_COST: 50,  // 앱 등록 비용
  },
  WITHDRAWAL: {
    MIN_AMOUNT: 10000,
    DAILY_LIMIT: 500000,
    FEE: 0, // 무료
  },
  TRUST_SCORE: {
    INITIAL: 50,
    WEIGHTS: {
      COMPLETION_RATE: 0.4,
      DROPOUT: 0.3,
      FEEDBACK_QUALITY: 0.2,
      ACTIVITY_PERIOD: 0.1,
    },
    DROPOUT_PENALTY: -10,
    BADGES: {
      BRONZE: { min: 0, max: 49 },
      SILVER: { min: 50, max: 69 },
      GOLD: { min: 70, max: 89 },
      DIAMOND: { min: 90, max: 100 },
    },
  },
  REWARD_AMOUNT_RANGE: {
    BASIC: { min: 1000, max: 2000 },
    WITH_FEEDBACK: { min: 2000, max: 4000 },
    ADVANCED: { min: 4000, max: 8000 },
  },
} as const;

export const ONE_TIME_PAYMENT = {
  TESTERS_20: { amount: 29000, testers: 20 },
  TESTERS_30: { amount: 39000, testers: 30 },
  BOOST: { amount: 5000, durationHours: 24 },
} as const;
```

## packages/shared/src/constants/index.ts

```typescript
export const TEST_DURATION_DAYS = 14;
export const MIN_PRODUCTION_TESTERS = 12;
export const MAX_CONCURRENT_TESTS = 5;
export const MAX_PAYMENT_METHODS = 5;
export const NICKNAME_CHANGE_DAYS = 30;
export const TICKET_AUTO_CLOSE_DAYS = 7;
export const NOTIFICATION_RETENTION_DAYS = 90;
export const WITHDRAWAL_RETENTION_DAYS = 30;
export const MAX_DAILY_TICKETS = 5;
export const MAX_DAILY_MESSAGES = 3;
export const WAITLIST_RATIO = 0.2; // target의 20%
export const DROPOUT_REPLACEMENT_CUTOFF_DAY = 10;
export const INACTIVE_WARNING_HOURS = 48;
export const PAYMENT_TIMEOUT_MINUTES = 10;
export const BILLING_RETRY_DAYS = [1, 3, 7]; // 결제 실패 재시도
export const EMAIL_RETRY_MAX = 3;
export const EMAIL_RETRY_INTERVALS = [5, 30, 120]; // 분
```

## Enum 전체 목록 (Prisma schema에 이미 정의됨)

| 카테고리 | Enum | 값 |
|---------|------|-----|
| 사용자 | Role | NONE, DEVELOPER, TESTER, BOTH, ADMIN |
| 사용자 | UserStatus | ACTIVE, SUSPENDED, WITHDRAWN |
| 사용자 | Plan | FREE, BASIC, PRO, ENTERPRISE |
| 사용자 | TrustBadge | BRONZE, SILVER, GOLD, DIAMOND |
| 사용자 | SocialProvider | GOOGLE, KAKAO, NAVER |
| 앱 | TestType | PAID_REWARD, CREDIT_EXCHANGE |
| 앱 | RewardType | BASIC, WITH_FEEDBACK, ADVANCED |
| 앱 | AppStatus | PENDING_APPROVAL, RECRUITING, IN_TESTING, COMPLETED, PRODUCTION, REJECTED, CANCELLED, BLOCKED |
| 지원 | ApplicationStatus | PENDING, APPROVED, REJECTED, WAITLISTED |
| 참여 | ParticipationStatus | ACTIVE, DROPPED, COMPLETED |
| 참여 | RewardStatus | NONE, PAID, PENDING_FEEDBACK, SKIPPED |
| 결제 | PaymentType | ONE_TIME_20, ONE_TIME_30, SUBSCRIPTION, BOOST, REFUND |
| 결제 | PaymentStatus | PENDING, SUCCESS, FAILED, REFUNDED, PARTIALLY_REFUNDED |
| 구독 | SubscriptionStatus | ACTIVE, CANCELLING, CANCELLED, PAST_DUE |
| 출금 | WithdrawalMethod | BANK_TRANSFER, PAYPAL |
| 출금 | WithdrawalStatus | REQUESTED, PROCESSING, ON_HOLD, COMPLETED, FAILED, REJECTED |
| 이미지 | AppImageType | ICON, SCREENSHOT |
| 피드백 | FeedbackItemType | UI_UX, PERFORMANCE, FUNCTIONALITY, STABILITY |
| 리워드 | RewardHistoryType | EARNED, WITHDRAWN, WITHDRAWAL_REFUND, EXCHANGED |
| 크레딧 | CreditHistoryType | EARNED_TEST, EARNED_FEEDBACK, USED_REGISTER |
| 신뢰도 | TrustScoreEvent | TEST_COMPLETED, DROPOUT, FEEDBACK_QUALITY, PERIOD_BONUS |
| 알림 | NotificationType | SELECTED, TEST_STARTED, DROPOUT, COMPLETED, REWARD, FEEDBACK_RECEIVED, WITHDRAWAL_DONE, NEW_APPLICATION, SYSTEM, WARNING, INACTIVE_WARNING |
| 문의 | InquiryType | BUG, PAYMENT, ACCOUNT, TEST, REWARD, REPORT, FEATURE, OTHER |
| 문의 | TicketPriority | URGENT, HIGH, NORMAL, LOW |
| 문의 | TicketStatus | SUBMITTED, IN_PROGRESS, ANSWERED, REOPENED, CLOSED |
| 문의 | SenderRole | USER, ADMIN |
| 신고 | ReportTarget | USER, APP |
| 신고 | ReportStatus | SUBMITTED, IN_REVIEW, WARNING, SUSPENDED, BLOCKED, DISMISSED |
| FAQ | FaqCategory | TEST, REWARD, PAYMENT, ACCOUNT |
| 공지 | NoticeTag | IMPORTANT, NOTICE, UPDATE, EVENT |
| 이메일 | EmailType | TESTER_SELECTED, TEST_STARTED, DROPOUT, COMPLETED, REWARD, FEEDBACK, WITHDRAWAL, TICKET_REPLY, WARNING, SYSTEM |
| 이메일 | EmailStatus | PENDING, SENT, FAILED |

---

# ⑤ 프론트엔드 컴포넌트 구조

## 공통 컴포넌트 (components/common/)

| 컴포넌트 | Props | 사용 화면 |
|---------|-------|----------|
| AppCard | app, showReward?, showStatus?, onClick | T-01, D-03 |
| StatusBadge | status, type(app/ticket/withdrawal) | 전체 |
| TrustBadge | score, badge | D-04 지원자, T-02 |
| StarRating | value, onChange?, readonly? | T-04, D-04 |
| FileUpload | accept, maxSize, maxFiles, onUpload | D-02, CS |
| ImageGallery | images[], onSwipe | T-02, D-04 |
| Pagination | page, totalPages, onChange | 목록 전체 |
| EmptyState | icon, title, description, action? | 목록 빈 상태 |
| ConfirmDialog | title, message, onConfirm, onCancel | 삭제/탈퇴/프로덕션 |
| LoadingSkeleton | variant(card/list/detail) | 로딩 전체 |

## 레이아웃 (components/layout/)

| 컴포넌트 | 설명 |
|---------|------|
| Navbar | 로고, 메뉴, 역할토글, 알림벨, 프로필 |
| Sidebar | 관리자 좌측 메뉴 |
| RoleToggle | 개발자 ↔ 테스터 전환 |
| NotificationBell | 미읽은 뱃지 + 드롭다운 (polling 30초) |

## 개발자 (components/dev/)

| 컴포넌트 | 설명 |
|---------|------|
| AppRegisterWizard | Step1~4 탭 위자드 (상태 관리) |
| ApplicantList | 지원자 카드 + 승인/거절 버튼 |
| ParticipantMonitor | 참여자 상태 테이블 (색상 코딩) |
| FeedbackList | 피드백 카드 + 필터 + 평균 별점 |
| ProductionChecklist | 자동/수동 체크 + 프로덕션 확인 버튼 |
| CostCalculator | 실시간 비용 계산 (테스터수 × 금액 × 수수료) |

## 테스터 (components/tester/)

| 컴포넌트 | 설명 |
|---------|------|
| AppBrowseFilter | 카테고리 칩 + 리워드 유형 + 정렬 |
| ApplyModal | 기기/메시지 입력 + 지원 버튼 |
| TestCard | 진행 중 카드 (D-Day, 실행 상태, Play 링크) |
| FeedbackForm | 별점 + 항목 + 텍스트 + 버그 (4섹션 폼) |
| RewardTab | 포인트/출금/기프티콘/크레딧 탭 |

---

# ⑥ 구현 가이드 (Claude Code 지시서)

## 구현 순서 (Phase별)

### Phase 0: 프로젝트 초기화 (1일)

```
1. 모노레포 셋업 (Turborepo + pnpm)
2. apps/server: NestJS 프로젝트 생성
3. apps/web: Next.js 14 프로젝트 생성
4. packages/shared: 공유 패키지 생성
5. docker-compose.yml로 PostgreSQL + Redis 실행
6. Prisma 스키마 적용 + 마이그레이션 + 시드
7. 환경변수 세팅
```

### Phase 1: 인증 (2~3일)

```
1. Prisma 모듈 설정 (prisma.service.ts)
2. 공통 모듈: guards, interceptors, filters, pipes
3. auth 모듈: Google OAuth → JWT 발급
4. auth 미들웨어: Access/Refresh 토큰 검증
5. signup 플로우: 역할선택 + 약관 + 프로필
6. 프론트: 랜딩, 로그인, 회원가입 화면
7. 프론트: axios 인스턴스 + 토큰 인터셉터
8. 테스트: 로그인 → 가입 → 토큰 갱신 E2E
```

### Phase 2: 개발자 - 앱 등록 (3~4일)

```
1. categories API (GET /categories)
2. dev/apps CRUD API
3. S3 업로드 모듈 (Pre-signed URL)
4. 비용 계산 로직
5. 프론트: D-01 대시보드
6. 프론트: D-02 앱 등록 위자드 (4단계)
7. 프론트: D-03 내 앱 목록
8. 테스트: 앱 등록 → 목록 조회 E2E
```

### Phase 3: 테스터 - 탐색/지원 (2~3일)

```
1. tester/apps API (목록, 상세, 지원)
2. 지원 검증 로직 (본인앱, 중복, 동시5개)
3. 프론트: T-01 앱 탐색 (검색/필터/정렬)
4. 프론트: T-02 앱 상세 + 지원 모달
5. 프론트: T-03 내 테스트 (3탭)
6. 테스트: 지원 → 목록 확인 E2E
```

### Phase 4: 개발자 - 매칭/테스트 관리 (3~4일)

```
1. dev/applicants API (목록, 승인, 거절, 일괄)
2. 테스트 시작 로직 (전원 승인 → IN_TESTING)
3. dev/participants API (모니터링, 메시지)
4. 이탈 처리 + 대기열 교체 로직
5. 프론트: D-04 앱 상세 (5탭)
6. 스케줄러: 테스트 자동 종료
7. 스케줄러: 미실행 경고
8. 테스트: 승인 → 시작 → 이탈 → 교체 E2E
```

### Phase 5: 피드백 + 리워드 (2~3일)

```
1. tester/feedback API (생성, 수정)
2. dev/feedbacks API (목록, 요약)
3. 프로덕션 확인 + 리워드 자동 지급 로직
4. rewards API (잔액, 내역)
5. 크레딧 적립 로직
6. 프론트: T-04 피드백 폼
7. 프론트: D-04 피드백 탭 + 프로덕션 탭
8. 프론트: T-05 리워드 (포인트 탭, 크레딧 탭)
```

### Phase 6: 결제 (3~4일)

```
1. 토스페이먼츠 래퍼 서비스
2. billing/payments API (건별, 승인)
3. billing/subscribe API (구독, 변경, 해지)
4. payment-methods API (CRUD)
5. 스케줄러: 구독 자동 결제
6. 프론트: D-05 결제/구독
7. 프론트: 앱 등록 시 결제 플로우
```

### Phase 7: 출금 (2일)

```
1. withdrawal API (신청, 내역)
2. bank-accounts API (등록, 인증)
3. 이상 감지 로직 (flagged)
4. 프론트: T-05 출금 탭
5. 스케줄러: 출금 배치
```

### Phase 8: 고객센터 (2일)

```
1. support API (FAQ, 공지, 티켓, 신고)
2. 프론트: CS-01 (4탭)
3. 프론트: 프로필, 알림 설정
```

### Phase 9: 관리자 (3~4일)

```
1. admin 전체 API (대시보드, 사용자, 앱, 정산, CS)
2. 프론트: A-01~05 관리자 화면
3. 출금 승인/보류/거절 로직
4. 신고 처리 로직
```

### Phase 10: 마무리 (2~3일)

```
1. 이메일 모듈 (AWS SES + 템플릿)
2. 알림 모듈 (FCM 푸시)
3. 프론트: 알림센터
4. Rate Limiting 적용
5. 에러 처리 통합
6. 전체 E2E 테스트
```

---

## 예상 총 기간: 25~35일 (1인 풀타임)

| Phase | 기간 | 누적 |
|-------|------|------|
| 0. 초기화 | 1일 | 1일 |
| 1. 인증 | 3일 | 4일 |
| 2. 앱 등록 | 4일 | 8일 |
| 3. 테스터 탐색 | 3일 | 11일 |
| 4. 매칭/테스트 | 4일 | 15일 |
| 5. 피드백/리워드 | 3일 | 18일 |
| 6. 결제 | 4일 | 22일 |
| 7. 출금 | 2일 | 24일 |
| 8. 고객센터 | 2일 | 26일 |
| 9. 관리자 | 4일 | 30일 |
| 10. 마무리 | 3일 | 33일 |

---

## Claude Code 프롬프트 예시

Phase별로 이렇게 지시하면 됩니다:

```
이 프로젝트의 설계 문서들을 참고해서 Phase 1(인증)을 구현해줘.

참고 파일:
- schema.prisma (DB 스키마)
- 프로젝트_폴더구조.md (디렉토리 구조)
- API_01_인증_개발자_테스터.md (API 명세)
- 기능상세_01_COM_공통.md (비즈니스 규칙)
- 화면흐름도_UserFlow.md (화면 연결)

구현할 것:
1. Prisma 모듈
2. JWT 인증 (Guard, Strategy)
3. Google OAuth 로그인
4. 회원가입 (역할+약관+프로필)
5. 토큰 갱신
6. 로그아웃
7. 프론트: 랜딩, 로그인, 가입 화면
```
