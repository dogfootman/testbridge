# TestBridge 기능 상세 정의서 ① 공통 (COM)

**업무분류**: COM (공통)  
**요구사항 수**: 17건 (P1: 11건, P2: 6건)

---

## COM-AUTH-001 | 소셜 로그인 (Google) | P1

### 기능 개요
Google OAuth 2.0을 통한 회원가입 및 로그인. Play Console 연동 필수.

### 입력값

| 항목 | 타입 | 필수 | 제약 조건 | 설명 |
|------|------|------|----------|------|
| Google OAuth Token | String | Y | Google 인증 서버 발급 | ID Token |

### 출력값

| 항목 | 타입 | 설명 |
|------|------|------|
| accessToken | String | JWT Access Token (1시간) |
| refreshToken | String | JWT Refresh Token (14일) |
| isNewUser | Boolean | 신규 여부 (true→역할 선택) |
| user.id | Number | 사용자 ID |
| user.email | String | Google 이메일 |
| user.name | String | 이름 |
| user.profileImage | URL | 프로필 이미지 |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-001 | 신규 자동 생성 | 이메일 DB 미존재 시 User 생성, isNewUser=true |
| BR-002 | 기존 로그인 | 이메일 DB 존재 시 로그인, isNewUser=false |
| BR-003 | 프로필 동기화 | Google에서 이름/이미지 초기값 가져옴 |
| BR-004 | 정지 차단 | status=SUSPENDED → 로그인 불가, 정지 사유 표시 |
| BR-005 | 탈퇴 처리 | status=WITHDRAWN 동일 이메일 → 신규 계정 (복구 불가) |
| BR-006 | 로그인 갱신 | lastLoginAt 업데이트 |

### 유효성 검증

| 항목 | 규칙 | 에러 메시지 |
|------|------|-----------|
| Token | Google 서버 검증 | "Google 인증에 실패했습니다. 다시 시도해주세요." |
| 이메일 | 유효 형식 | "유효하지 않은 이메일입니다." |

### 에러 처리

| 에러 코드 | HTTP | 상황 | 응답 메시지 | 화면 처리 |
|----------|------|------|-----------|----------|
| AUTH-001 | 401 | 토큰 검증 실패 | "Google 인증에 실패했습니다." | 재시도 버튼 |
| AUTH-002 | 403 | 정지 계정 | "이용이 정지된 계정입니다." | 사유+고객센터 안내 |
| AUTH-003 | 500 | 서버 오류 | "일시적인 오류입니다." | 3초 후 자동 재시도 |
| AUTH-004 | 403 | 탈퇴 중 (30일 이내) | "탈퇴 처리 중인 계정입니다." | 철회 안내 |

### 상태 변화

| 전 | 이벤트 | 후 |
|----|--------|-----|
| (없음) | 신규 가입 | User: status=ACTIVE, role=null |
| ACTIVE | 로그인 | lastLoginAt 갱신 |

### 화면 연결

| 시작 | 동작 | 이동 |
|------|------|------|
| S-01 랜딩 | Google 로그인 클릭 | OAuth 팝업 |
| OAuth | 성공+신규 | S-02 회원가입 |
| OAuth | 성공+기존(개발자) | D-01 대시보드 |
| OAuth | 성공+기존(테스터) | T-01 홈 |
| OAuth | 실패 | S-01 (에러) |

### 연관: COM-AUTH-004, COM-AUTH-008, COM-PRF-001

---

## COM-AUTH-002 | 소셜 로그인 (카카오) | P2

### 기능 개요
카카오 OAuth 회원가입/로그인.

### 입력값

| 항목 | 타입 | 필수 | 설명 |
|------|------|------|------|
| Kakao Auth Code | String | Y | 카카오 인증 코드 |

### 출력값: COM-AUTH-001과 동일

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-007 | 계정 통합 | 카카오 이메일 = 기존 Google 이메일 → socialAccounts에 추가 연동 |
| BR-008 | 이메일 미제공 | 카카오 이메일 미제공 시 이메일 입력 팝업 |
| BR-009 | 동의 항목 | 이메일, 프로필 동의 필수 |

### 에러 처리

| 에러 코드 | HTTP | 상황 | 응답 메시지 |
|----------|------|------|-----------|
| AUTH-005 | 401 | 카카오 인증 실패 | "카카오 인증에 실패했습니다." |
| AUTH-006 | 409 | 이메일 충돌 | "해당 이메일로 가입된 계정이 있습니다. Google로 로그인해주세요." |

### 연관: COM-AUTH-001

---

## COM-AUTH-003 | 소셜 로그인 (네이버) | P2

### 기능 개요
네이버 OAuth 회원가입/로그인.

### 입력값

| 항목 | 타입 | 필수 | 설명 |
|------|------|------|------|
| Naver Auth Code | String | Y | 인증 코드 |
| state | String | Y | CSRF 방지 토큰 |

### 비즈니스 규칙: COM-AUTH-002와 동일 구조 (Provider만 변경)

### 연관: COM-AUTH-001, COM-AUTH-002

---

## COM-AUTH-004 | 역할 선택 | P1

### 기능 개요
회원가입 시 역할 선택.

### 입력값

| 항목 | 타입 | 필수 | 제약 | 설명 |
|------|------|------|------|------|
| role | Enum | Y | DEVELOPER, TESTER, BOTH | 역할 |

### 출력값

| 항목 | 타입 | 설명 |
|------|------|------|
| user.role | Enum | 설정된 역할 |
| redirectPath | String | 역할별 초기 화면 |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-012 | 초기 화면 | DEVELOPER→D-01, TESTER→T-01, BOTH→D-01 |
| BR-013 | BOTH 권한 | 양쪽 기능 모두 사용, 상단 토글 전환 |
| BR-014 | 변경 가능 | 마이페이지에서 언제든 변경 |
| BR-015 | 필수 | 미선택 시 가입 버튼 비활성화 |
| BR-016 | Free 자동 | 가입 완료 시 Free 플랜 자동 적용 |

### 유효성 검증

| 항목 | 규칙 | 에러 메시지 |
|------|------|-----------|
| role | Enum 유효값 | "역할을 선택해주세요." |

### 화면 연결

| 시작 | 동작 | 이동 |
|------|------|------|
| S-02 | 개발자 선택+완료 | D-01 |
| S-02 | 테스터 선택+완료 | T-01 |
| S-02 | 둘 다 선택+완료 | D-01 |

### 연관: COM-AUTH-001, COM-AUTH-005, COM-PRF-003

---

## COM-AUTH-005 | 이용약관 동의 | P1

### 기능 개요
이용약관 및 개인정보처리방침 동의.

### 입력값

| 항목 | 타입 | 필수 | 기본값 | 설명 |
|------|------|------|--------|------|
| termsAgreed | Boolean | Y | false | 이용약관 |
| privacyAgreed | Boolean | Y | false | 개인정보처리방침 |
| marketingAgreed | Boolean | N | false | 마케팅 수신 (선택) |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-017 | 필수 동의 | termsAgreed+privacyAgreed 모두 true여야 가입 |
| BR-018 | 이력 저장 | 동의 일시, 약관 버전, IP, User Agent 기록 |
| BR-019 | 재동의 | 약관 개정 시 로그인 후 재동의 팝업. 미동의 시 이용 불가 |
| BR-020 | 전체 동의 | "전체 동의" 체크 시 필수+선택 모두 체크 |
| BR-021 | 전문 보기 | 링크 클릭 → 약관 전문 새 탭 |

### 유효성 검증

| 항목 | 규칙 | 에러 메시지 |
|------|------|-----------|
| termsAgreed | true | "이용약관에 동의해주세요." |
| privacyAgreed | true | "개인정보처리방침에 동의해주세요." |

### 연관: COM-AUTH-001, COM-AUTH-004

---

## COM-AUTH-006 | 로그아웃 | P1

### 기능 개요
세션 종료.

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-022 | Refresh Token 삭제 | 서버 DB에서 삭제 |
| BR-023 | 클라이언트 삭제 | 쿠키/스토리지 토큰 삭제 |
| BR-024 | 확인 다이얼로그 | "로그아웃 하시겠습니까?" |

### 화면 연결: S-04 → "로그아웃" → S-01 랜딩

### 연관: COM-AUTH-008

---

## COM-AUTH-007 | 회원탈퇴 | P2

### 기능 개요
계정 삭제 요청.

### 입력값

| 항목 | 타입 | 필수 | 제약 | 설명 |
|------|------|------|------|------|
| reason | Enum | N | 5개 사유 | 탈퇴 사유 |
| reasonDetail | String | N | 500자 | 상세 사유 |
| confirmText | String | Y | "탈퇴합니다" 정확 입력 | 확인 |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-025 | 진행 중 테스트 | IN_TESTING 있으면 탈퇴 불가 |
| BR-026 | 포인트 경고 | balance>0 → "미출금 {N}원 소멸" 경고 |
| BR-027 | 출금 경고 | 처리 중 출금 있으면 "출금 {N}건 취소" 경고 |
| BR-028 | 소프트 삭제 | status=WITHDRAWN. 30일 후 배치 영구 삭제 |
| BR-029 | 확인 이메일 | 탈퇴 완료 이메일 |
| BR-030 | 철회 | 30일 이내 재로그인 → "철회하시겠습니까?" |

### 유효성 검증

| 항목 | 규칙 | 에러 메시지 |
|------|------|-----------|
| confirmText | "탈퇴합니다" | "확인 텍스트를 정확히 입력해주세요." |
| 진행 중 테스트 | 0건 | "진행 중 테스트 {N}건 완료 후 탈퇴 가능합니다." |

### 상태 변화

| 전 | 이벤트 | 후 |
|----|--------|-----|
| ACTIVE | 탈퇴 요청 | WITHDRAWN (withdrawnAt=now) |
| WITHDRAWN | 30일 경과 | 배치: 개인정보 영구 삭제 |
| WITHDRAWN | 30일 내 재로그인+철회 | ACTIVE |

### 연관: COM-AUTH-001, RWD-PNT-001

---

## COM-AUTH-008 | JWT 토큰 인증 | P1

### 기능 개요
Access/Refresh Token 기반 인증 체계.

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-031 | Access 유효기간 | 1시간 |
| BR-032 | Refresh 유효기간 | 14일 |
| BR-033 | Refresh 회전 | 사용 시 새 토큰 발급, 이전 즉시 무효화 |
| BR-034 | 동시 세션 | 최대 3 디바이스. 초과 시 가장 오래된 만료 |
| BR-035 | 인증 범위 | 로그인/가입/랜딩/FAQ 외 모든 API 필수 |
| BR-036 | 페이로드 | { userId, email, role, iat, exp } |
| BR-037 | 서명 | HS256 + 서버 시크릿 키 |

### 에러 처리

| 에러 코드 | HTTP | 상황 | 화면 처리 |
|----------|------|------|----------|
| AUTH-011 | 401 | Access 만료 | Refresh로 자동 갱신 |
| AUTH-012 | 401 | Refresh 만료 | "세션 만료" → 로그인 화면 |
| AUTH-013 | 401 | 토큰 변조 | 전체 세션 무효화 → 로그인 |

### 연관: COM-AUTH-001, COM-AUTH-006, NFR-SEC-001

---

## COM-PRF-001 | 프로필 설정 | P1

### 기능 개요
회원가입 시 초기 프로필 설정.

### 입력값

| 항목 | 타입 | 필수 | 제약 | 설명 |
|------|------|------|------|------|
| nickname | String | Y | 2~20자, 한/영/숫자/_, 중복불가 | 표시 이름 |
| profileImage | File | N | JPG/PNG, 5MB, 100x100px 이상 | 프로필 이미지 |
| bio | String | N | 200자 | 자기소개 |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-038 | 실시간 중복 | blur 이벤트 시 닉네임 중복 확인 |
| BR-039 | 금칙어 | 욕설, admin/testbridge/운영자 등 차단 |
| BR-040 | 이미지 리사이징 | 256x256 WebP 변환 + CDN 업로드 |
| BR-041 | 기본 아바타 | 미업로드 시 이니셜 기반 아바타 |

### 유효성 검증

| 항목 | 규칙 | 에러 메시지 |
|------|------|-----------|
| nickname | 2~20자 | "2~20자로 입력해주세요." |
| nickname | 한/영/숫자/_ | "한글, 영문, 숫자, _만 가능합니다." |
| nickname | 중복 | "이미 사용 중인 닉네임입니다." |
| nickname | 금칙어 | "사용할 수 없는 닉네임입니다." |
| profileImage | 5MB | "5MB 이하여야 합니다." |
| profileImage | JPG/PNG | "JPG 또는 PNG만 가능합니다." |
| bio | 200자 | "200자 이내로 작성해주세요." |

### 연관: COM-PRF-002, COM-AUTH-001

---

## COM-PRF-002 | 프로필 편집 | P1

### 기능 개요
마이페이지에서 프로필 수정.

### 입력값: COM-PRF-001과 동일

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-042 | 닉네임 30일 제한 | 30일에 1회만 변경 |
| BR-043 | 변경 이력 | 닉네임 변경 이력 기록 |
| BR-044 | 이미지 삭제 | 삭제 시 기본 아바타 복귀 |
| BR-045 | 변경 없으면 | 저장 버튼 비활성화 |

### 에러 처리

| 에러 코드 | HTTP | 상황 | 응답 메시지 |
|----------|------|------|-----------|
| PRF-001 | 429 | 닉네임 변경 제한 | "30일에 1회 변경 가능. 다음: {날짜}" |

### 연관: COM-PRF-001

---

## COM-PRF-003 | 역할 전환 | P1

### 기능 개요
마이페이지에서 개발자 ↔ 테스터 전환.

### 입력값

| 항목 | 타입 | 필수 | 설명 |
|------|------|------|------|
| targetRole | Enum | Y | DEVELOPER 또는 TESTER |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-046 | 즉시 전환 | 해당 모드 홈으로 이동 |
| BR-047 | 데이터 유지 | 양쪽 데이터 모두 유지 |
| BR-048 | 자동 BOTH | DEVELOPER만인 사용자가 TESTER 전환 시 role→BOTH |
| BR-049 | Nav 연동 | 상단 역할 토글과 동기화 |

### 화면 연결

| 시작 | 동작 | 이동 |
|------|------|------|
| S-04 | "개발자 모드" | D-01 |
| S-04 | "테스터 모드" | T-01 |

### 연관: COM-AUTH-004

---

## COM-PRF-004 | 활동 통계 표시 | P2

### 기능 개요
마이페이지 역할별 활동 통계.

### 출력값 (개발자)

| 항목 | 산출 |
|------|------|
| totalApps | COUNT(apps WHERE developerId=userId) |
| productionSuccess | COUNT(apps WHERE status=PRODUCTION) |
| inProgress | COUNT(apps WHERE status IN (RECRUITING, IN_TESTING)) |

### 출력값 (테스터)

| 항목 | 산출 |
|------|------|
| completedTests | COUNT(participations WHERE status=COMPLETED) |
| completionRate | (completed / totalSelected) × 100 |
| totalReward | SUM(rewardHistory WHERE type=EARNED) |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-050 | 역할별 분기 | 현재 모드에 따라 해당 통계만 표시 |
| BR-051 | 캐싱 | 1시간 캐싱 |

### 연관: COM-PRF-001, TST-TRS-005

---

## COM-PRF-005 | 구독/크레딧 현황 | P2

### 기능 개요
플랜, 앱 등록 수, 크레딧 표시.

### 출력값

| 항목 | 타입 | 설명 |
|------|------|------|
| currentPlan | Enum | FREE/BASIC/PRO/ENTERPRISE |
| planPrice | Number | 월 요금 |
| remainingApps | Number | 남은 등록 수 |
| maxApps | Number | 플랜 최대 수 |
| creditBalance | Number | 크레딧 잔액 |
| nextBillingDate | Date | 다음 결제일 |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-052 | 초기화 | 매월 1일 remainingApps=maxApps 리셋 |
| BR-053 | 한도 | FREE:1, BASIC:10, PRO:50, ENTERPRISE:100 |

### 연관: PAY-SUB-001, RWD-CRD-003

---

## COM-NTF-001 | 이메일 알림 | P1

### 기능 개요
주요 이벤트 시 이메일 발송.

### 트리거 목록

| 유형 | 트리거 | 수신자 | 제목 |
|------|--------|--------|------|
| 선정 | 지원자 승인 | 테스터 | "{앱명} 테스트에 선정되었습니다!" |
| 시작 | 전원 승인 | 개발자 | "{앱명} 테스트가 시작되었습니다" |
| 이탈 | 옵트아웃/삭제 | 개발자 | "{앱명} 테스터 이탈 알림" |
| 완료 | 14일 종료 | 양쪽 | "{앱명} 테스트가 완료되었습니다" |
| 리워드 | 포인트 적립 | 테스터 | "리워드 {금액}원 지급" |
| 피드백 | 피드백 제출 | 개발자 | "{앱명} 새 피드백 도착" |
| 출금 | 이체 완료 | 테스터 | "{금액}원 출금 완료" |
| 지원 | 테스터 지원 | 개발자 | "{앱명} 새 지원자" |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-055 | 비동기 | 메시지 큐 적재 후 워커 발송 |
| BR-056 | 재시도 | 실패 시 5분/30분/2시간 최대 3회 |
| BR-057 | 수신 거부 | emailEnabled=false 시 미발송 |
| BR-058 | 템플릿 | HTML 템플릿 (로고+본문+CTA) |
| BR-059 | 이력 | 모든 발송 이력 DB 기록 |

### 연관: COM-NTF-004, DEV-TSM-002

---

## COM-NTF-002 | 알림 센터 | P1

### 기능 개요
모든 알림 모아보기.

### 출력값

| 항목 | 타입 | 설명 |
|------|------|------|
| notifications[].id | Number | 알림 ID |
| notifications[].type | Enum | 알림 유형 |
| notifications[].title | String | 제목 |
| notifications[].message | String | 내용 |
| notifications[].isRead | Boolean | 읽음 여부 |
| notifications[].createdAt | DateTime | 생성 시간 |
| notifications[].linkUrl | String | 이동 경로 |
| unreadCount | Number | 미읽은 수 (Nav 뱃지) |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-060 | 최신순 | createdAt DESC |
| BR-061 | 보관 90일 | 이후 배치 삭제 |
| BR-062 | 클릭 읽음 | 클릭 → isRead=true + 이동 |
| BR-063 | 전체 읽음 | "모두 읽음" 버튼 |
| BR-064 | 무한 스크롤 | 20개씩 |
| BR-065 | 뱃지 갱신 | 30초 polling 또는 SSE |

### 연관: COM-NTF-001

---

## COM-NTF-003 | 푸시 알림 | P2

### 기능 개요
FCM 브라우저/모바일 푸시.

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-066 | FCM 토큰 | 로그인 시 등록, 로그아웃 시 삭제 |
| BR-067 | 권한 요청 | 최초 방문 시 요청. 거부해도 서비스 이용 가능 |
| BR-068 | 내용 | 제목+50자 내용. 클릭 시 해당 화면 |
| BR-069 | 조건 | pushEnabled=true인 사용자만 |

### 연관: COM-NTF-001, COM-NTF-004

---

## COM-NTF-004 | 알림 설정 | P2

### 기능 개요
채널별 ON/OFF.

### 입력값

| 항목 | 타입 | 필수 | 기본값 | 설명 |
|------|------|------|--------|------|
| pushEnabled | Boolean | N | true | 푸시 |
| emailEnabled | Boolean | N | true | 이메일 |
| smsEnabled | Boolean | N | false | SMS |

### 비즈니스 규칙

| 규칙 ID | 규칙 | 상세 |
|---------|------|------|
| BR-070 | 긴급 예외 | 보안/결제 알림은 항상 발송 |
| BR-071 | SMS 인증 | true 설정 시 휴대폰 인증 필수 |
| BR-072 | 즉시 적용 | 토글 변경 → 즉시 저장 |

### 에러 처리

| 에러 코드 | HTTP | 상황 | 응답 메시지 |
|----------|------|------|-----------|
| NTF-001 | 400 | SMS 인증 미완료 | "SMS 알림을 위해 휴대폰 인증이 필요합니다." |

### 연관: COM-NTF-001, COM-NTF-003
