# TestBridge 비즈니스 프로세스 & 데이터 흐름 정의서

**버전**: v1.0  
**작성일**: 2026-02-28  
**목적**: 핵심 비즈니스 프로세스의 단계별 액터, 트리거, 조건, 데이터 변화를 정의하여 ERD 설계의 입력으로 활용

---

## 핵심 프로세스 목록

| # | 프로세스 | 관여 액터 | 중요도 |
|---|---------|----------|--------|
| BP-01 | 회원가입/인증 | 사용자, Google, 시스템 | ★★★ |
| BP-02 | 앱 등록 | 개발자, 관리자, PG | ★★★ |
| BP-03 | 테스터 모집/매칭 | 개발자, 테스터, 시스템 | ★★★ |
| BP-04 | 테스트 진행 | 테스터, 시스템 | ★★★ |
| BP-05 | 피드백/프로덕션/리워드 | 테스터, 개발자, 시스템 | ★★★ |
| BP-06 | 출금/정산 | 테스터, 관리자, 은행 | ★★☆ |
| BP-07 | 구독/결제 | 개발자, PG | ★★☆ |

---

# BP-01. 회원가입/인증 프로세스

## 시퀀스

```
사용자          프론트엔드         서버              Google
  │               │               │                  │
  ├─로그인 클릭──→│               │                  │
  │               ├─OAuth 팝업───→│                  │
  │               │               │                  │
  │  ◀──Google 로그인 화면────────┤◀────────────────┤
  │               │               │                  │
  ├─Google 인증──→│               │                  │
  │               │               ├─토큰 검증 요청──→│
  │               │               │◀──사용자 정보────┤
  │               │               │                  │
  │               │               ├─[DB] 이메일 조회─┤
  │               │               │                  │
  │               │  ┌────────────┤                  │
  │               │  │ 신규       │                  │
  │               │  │ → User 생성│                  │
  │               │  │ → 역할선택 │                  │
  │               │  │ → 약관동의 │                  │
  │               │  │ → 프로필설정│                  │
  │               │  ├────────────┤                  │
  │               │  │ 기존       │                  │
  │               │  │ → 로그인   │                  │
  │               │  └────────────┤                  │
  │               │               │                  │
  │  ◀──JWT 발급 + 화면 이동──────┤                  │
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | Google 인증 | 로그인 버튼 클릭 | - | (외부 처리) |
| 2 | 이메일 조회 | OAuth 토큰 수신 | - | SELECT users WHERE email = {googleEmail} |
| 3a | 신규 회원 생성 | 이메일 미존재 | - | **INSERT users** (email, name, profileImage, status=ACTIVE, role=null, provider=GOOGLE, providerId, createdAt) |
| 3b | 소셜 계정 연결 | 기존 이메일 다른 provider | - | **INSERT social_accounts** (userId, provider, providerId) |
| 4 | 역할 선택 | 사용자 선택 | role IN (DEVELOPER, TESTER, BOTH) | **UPDATE users** SET role={role} |
| 5 | 약관 동의 | 체크 + 완료 | terms+privacy = true | **INSERT user_agreements** (userId, termsVersion, privacyVersion, marketingAgreed, agreedAt, ipAddress, userAgent) |
| 6 | 프로필 설정 | 닉네임 입력 | 중복/금칙어 통과 | **UPDATE users** SET nickname, bio; **INSERT 또는 UPDATE user_profiles** (profileImageUrl) |
| 7 | JWT 발급 | 가입/로그인 완료 | - | **INSERT refresh_tokens** (userId, token, deviceInfo, expiresAt); **UPDATE users** SET lastLoginAt=now() |

## 생성되는 데이터 엔티티

| 엔티티 | 생성 시점 | 비고 |
|--------|----------|------|
| **users** | 최초 가입 | 핵심 엔티티 |
| **social_accounts** | 가입 또는 추가 연동 시 | 1:N (한 유저 여러 소셜) |
| **user_agreements** | 약관 동의 시 | 버전별 이력 |
| **refresh_tokens** | 로그인 시 | 디바이스별 |
| **nickname_histories** | 닉네임 변경 시 | 변경 이력 |

---

# BP-02. 앱 등록 프로세스

## 시퀀스

```
개발자           서버              관리자           PG(토스)
  │               │                │                │
  ├─Step1 입력───→│                │                │
  │  (이름,패키지,│                │                │
  │   카테고리,설명)               │                │
  │               ├─패키지 중복확인│                │
  │               │                │                │
  ├─Step1 이미지─→│                │                │
  │  (아이콘,     │                │                │
  │   스크린샷)   ├─S3 업로드     │                │
  │               │                │                │
  ├─Step2 설정──→│                │                │
  │  (유형,테스터수,               │                │
  │   기간,링크)  │                │                │
  │               │                │                │
  │  ┌────────────┤                │                │
  │  │PAID_REWARD │                │                │
  │  │            │                │                │
  ├──┤Step3 리워드→│                │                │
  │  │(유형,금액) │                │                │
  │  │            │                │                │
  │  │            ├─비용 계산     │                │
  │  │            │                │                │
  ├──┤Step4 피드백→│                │                │
  │  │(필수여부,  │                │                │
  │  │ 항목,가이드)│                │                │
  │  └────────────┤                │                │
  │               │                │                │
  ├─결제 진행────→│────────────────│───결제 요청───→│
  │               │◀───────────────│◀──결제 결과────┤
  │               │                │                │
  │               ├─[DB] App 생성 │                │
  │               │  status=PENDING│                │
  │               │                │                │
  │               │──승인요청────→│                │
  │               │                ├─검토          │
  │               │                ├─승인/반려     │
  │               │◀──결과────────┤                │
  │               │                │                │
  │               ├─[DB] 상태변경 │                │
  │◀──결과 알림──┤                │                │
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | 기본 정보 | Step1 완료 | 패키지 중복X, 한도 미초과 | 세션 임시 저장 (DB 미저장) |
| 2 | 이미지 업로드 | 파일 선택 | 형식/크기 유효 | **S3 업로드** → URL 반환 (DB 미저장) |
| 3 | 테스트 설정 | Step2 완료 | - | 세션 임시 저장 |
| 4 | 리워드 설정 | Step3 완료 (PAID만) | 범위 내 | 세션 임시 저장 |
| 5 | 피드백 설정 | Step4 완료 | 최소 1항목 | 세션 임시 저장 |
| 6a | 결제 (PAID) | 등록 버튼 | 결제 성공 | **INSERT payments** (orderId, amount, method, status=SUCCESS, pgPaymentId, appId) |
| 6b | 크레딧 차감 (CREDIT) | 등록 버튼 | creditBalance ≥ 50 | **UPDATE users** SET creditBalance -= 50; **INSERT credit_histories** (userId, type=USED_REGISTER, amount=-50, appId) |
| 7 | 앱 생성 | 결제/크레딧 완료 | - | **INSERT apps** (developerId, appName, packageName, categoryId, description, testType, targetTesters, testLink, rewardType, rewardAmount, feedbackRequired, testGuide, status=PENDING_APPROVAL) |
| 8 | 이미지 연결 | 앱 생성 직후 | - | **INSERT app_images** (appId, type=ICON/SCREENSHOT, url, order) |
| 9 | 피드백 항목 저장 | 앱 생성 직후 | - | **INSERT app_feedback_items** (appId, itemType=UI_UX/PERFORMANCE/...) |
| 10 | 관리자 승인 | 관리자 액션 | 검토 통과 | **UPDATE apps** SET status=RECRUITING, approvedAt=now(); **INSERT notifications** (개발자에게 승인 알림) |
| 10b | 관리자 반려 | 관리자 액션 | 부적격 | **UPDATE apps** SET status=REJECTED, rejectedReason; **INSERT notifications** |

## 생성되는 데이터 엔티티

| 엔티티 | 생성 시점 | 비고 |
|--------|----------|------|
| **apps** | 등록 완료 시 | 핵심 엔티티 |
| **app_images** | 앱 생성 시 | 1:N (아이콘+스크린샷) |
| **app_feedback_items** | 앱 생성 시 | 1:N (피드백 항목) |
| **payments** | 결제 성공 시 | PAID_REWARD만 |
| **credit_histories** | 크레딧 차감 시 | CREDIT_EXCHANGE만 |

---

# BP-03. 테스터 모집/매칭 프로세스

## 시퀀스

```
테스터           서버              개발자
  │               │                │
  ├─앱 목록 조회─→│                │
  │◀──RECRUITING ──┤                │
  │  앱 리스트    │                │
  │               │                │
  ├─앱 상세 조회─→│                │
  │◀──상세 정보───┤                │
  │               │                │
  ├─테스트 지원──→│                │
  │  (기기,메시지)│                │
  │               ├─검증:          │
  │               │  본인앱? 중복? │
  │               │  동시5개? 슬롯?│
  │               │                │
  │               ├─[DB] Application│
  │               │  생성          │
  │               │                │
  │               │──지원 알림───→│
  │               │                │
  │               │                ├─지원자 목록 조회
  │               │◀──지원자 리스트┤
  │               │                │
  │               │                ├─승인/거절
  │               │◀──액션────────┤
  │               │                │
  │               ├─[DB] 상태변경  │
  │               │                │
  │◀──선정 알림 + │                │
  │   테스트 링크 │                │
  │               │                │
  │               ├─[전원 승인 시] │
  │               │  App→IN_TESTING│
  │               │  14일 카운트   │
  │               │──시작 알림───→│
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | 앱 목록 | T-01 진입 | - | SELECT apps WHERE status=RECRUITING |
| 2 | 테스트 지원 | "지원하기" 클릭 | 본인앱X, 중복X, 동시<5, 슬롯확인 | **INSERT applications** (appId, testerId, deviceInfo, message, status=PENDING/WAITLISTED, appliedAt) |
| 3 | 지원 알림 | 지원 생성 후 | - | **INSERT notifications** (userId=developerId, type=NEW_APPLICATION) |
| 4 | 승인 | 개발자 "승인" | 승인수 ≤ targetTesters | **UPDATE applications** SET status=APPROVED, approvedAt; **INSERT notifications** (testerId, type=SELECTED); **INSERT participations** (appId, testerId, status=ACTIVE, joinedAt) |
| 5 | 거절 | 개발자 "거절" | - | **UPDATE applications** SET status=REJECTED; **INSERT notifications** (testerId, type=REJECTED) |
| 6 | 테스트 시작 | 승인수 = targetTesters | 전원 승인 | **UPDATE apps** SET status=IN_TESTING, testStartDate=now(), testEndDate=now()+14; **INSERT notifications** (developerId, type=TEST_STARTED) |

## 생성되는 데이터 엔티티

| 엔티티 | 생성 시점 | 비고 |
|--------|----------|------|
| **applications** | 지원 시 | 테스터→앱 지원 이력 |
| **participations** | 승인 시 | 실제 참여 기록 (테스트 추적) |
| **notifications** | 각 이벤트 시 | 알림 |

---

# BP-04. 테스트 진행 프로세스

## 시퀀스

```
테스터           서버              개발자         스케줄러
  │               │                │               │
  │               │                │               │
  │  ◀──D+1 시작──┤                │               │
  │               │                │               │
  ├─Play 열기───→│                │               │
  │  (테스트 링크)│                │               │
  │               ├─[DB] 실행기록 │               │
  │               │                │               │
  │  ... 14일간 반복 ...           │               │
  │               │                │               │
  │  [이탈 발생]  │                │               │
  ├─앱삭제/옵트아웃→│               │               │
  │               ├─[DB] 이탈처리 │               │
  │               │  participation │               │
  │               │  →DROPPED      │               │
  │               │                │               │
  │               ├─대기열 확인   │               │
  │               │  (D+10 이전?) │               │
  │               │                │               │
  │  [대기열 있음]│                │               │
  │               ├─자동 교체     │               │
  │               │──이탈 알림──→│               │
  │               │                │               │
  │               │                │               │
  │               │                │  ◀──D+14 체크──┤
  │               │                │               │
  │               ├─[DB] 테스트완료│               │
  │               │  App→COMPLETED │               │
  │◀──완료 알림──┤──완료 알림──→│               │
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | 앱 실행 기록 | Play 링크 클릭 | - | **UPDATE participations** SET lastAppRunAt=now() |
| 2 | 이탈 감지 | 앱삭제/옵트아웃 | - | **UPDATE participations** SET status=DROPPED, droppedAt=now(), dropReason |
| 3 | 이탈 페널티 | 이탈 처리 후 | - | **UPDATE users** SET trustScore -= 10; **INSERT trust_score_histories** (testerId, event=DROPOUT, delta=-10) |
| 4 | 대기열 교체 | 이탈 + 대기열 존재 | currentDay ≤ 10 | **UPDATE applications** SET status=APPROVED (대기열 1순위); **INSERT participations** (새 테스터); **INSERT notifications** (2건: 개발자 이탈알림, 새 테스터 선정알림) |
| 5 | 미실행 경고 | 48시간 미실행 | lastAppRunAt < now()-48h | **INSERT notifications** (testerId, type=INACTIVE_WARNING) |
| 6 | 테스트 완료 | D+14 23:59:59 | 스케줄러 | **UPDATE apps** SET status=COMPLETED; **UPDATE participations** SET status=COMPLETED WHERE status=ACTIVE; **INSERT notifications** (전원) |

## 생성되는 데이터 엔티티

| 엔티티 | 변경 시점 | 비고 |
|--------|----------|------|
| **participations** | 실행/이탈/완료 | 상태 추적 핵심 |
| **trust_score_histories** | 이탈 시 | 신뢰도 변경 이력 |

---

# BP-05. 피드백 → 프로덕션 → 리워드 프로세스

## 시퀀스

```
테스터           서버              개발자
  │               │                │
  │  [테스트 완료 후]              │
  │               │                │
  ├─피드백 작성──→│                │
  │  (별점, 항목, │                │
  │   텍스트, 버그)│               │
  │               ├─[DB] 피드백   │
  │               │  저장          │
  │               │──피드백 알림─→│
  │               │                │
  │               │                ├─피드백 조회
  │               │                ├─프로덕션 체크리스트
  │               │                ├─"프로덕션 확인"
  │               │◀──확인────────┤
  │               │                │
  │               ├─[DB] App      │
  │               │  →PRODUCTION   │
  │               │                │
  │               ├─리워드 지급   │
  │               │  판정 로직     │
  │               │                │
  │◀──리워드 알림─┤──지급 알림──→│
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | 피드백 작성 | 테스터 제출 | 테스트 완료, 기한 내 | **INSERT feedbacks** (appId, testerId, overallRating, comment, type=FEEDBACK/BUG_REPORT, createdAt) |
| 2 | 항목별 별점 | 피드백과 동시 | - | **INSERT feedback_ratings** (feedbackId, itemType, score) |
| 3 | 버그 리포트 | 선택 제출 | bugTitle 입력 시 | **INSERT bug_reports** (feedbackId, title, description, deviceInfo); **INSERT bug_report_images** (S3 URL) |
| 4 | 피드백 알림 | 피드백 생성 후 | - | **INSERT notifications** (developerId, type=FEEDBACK_RECEIVED) |
| 5 | 프로덕션 확인 | 개발자 버튼 | status=COMPLETED, active≥12 | **UPDATE apps** SET status=PRODUCTION, productionConfirmedAt |
| 6 | 리워드 판정 | 프로덕션 확인 직후 | - | 각 테스터별 판정 (아래 상세) |
| 7a | 지급 | 조건 충족 | ACTIVE + 피드백 조건 충족 | **UPDATE users** SET pointBalance += rewardAmount; **INSERT reward_histories** (testerId, appId, type=EARNED, amount); **UPDATE participations** SET rewardStatus=PAID |
| 7b | 보류 | 피드백 미제출 | 기한 내 | **UPDATE participations** SET rewardStatus=PENDING_FEEDBACK |
| 7c | 미지급 | 이탈/기한초과 | - | **UPDATE participations** SET rewardStatus=SKIPPED, skipReason |
| 8 | 크레딧 적립 | 리워드 지급과 동시 | testType=CREDIT_EXCHANGE | **UPDATE users** SET creditBalance += 20 (피드백 시 +10); **INSERT credit_histories** (EARNED_TEST/EARNED_FEEDBACK) |
| 9 | 신뢰도 갱신 | 리워드 지급 후 | - | **UPDATE users** SET trustScore = 재계산; **INSERT trust_score_histories** (event=TEST_COMPLETED, delta) |

## 생성되는 데이터 엔티티

| 엔티티 | 생성 시점 | 비고 |
|--------|----------|------|
| **feedbacks** | 피드백 제출 | 1테스터 1앱 1피드백 |
| **feedback_ratings** | 피드백과 동시 | 항목별 별점 |
| **bug_reports** | 버그 제출 | 선택사항 |
| **bug_report_images** | 버그에 첨부 | S3 URL |
| **reward_histories** | 지급 시 | 포인트 변동 이력 |
| **credit_histories** | 크레딧 변동 시 | 크레딧 변동 이력 |

---

# BP-06. 출금/정산 프로세스

## 시퀀스

```
테스터           서버              관리자           은행
  │               │                │                │
  ├─출금 신청───→│                │                │
  │  (방식,계좌, │                │                │
  │   금액)       │                │                │
  │               ├─검증: 잔액,   │                │
  │               │  최소금액, 한도│                │
  │               │                │                │
  │               ├─[DB] 출금요청 │                │
  │               │  pointBalance  │                │
  │               │  -= amount     │                │
  │               │                │                │
  │               │──출금 알림──→│                │
  │               │  (이상감지 시 │                │
  │               │   플래그 표시) │                │
  │               │                │                │
  │               │                ├─검토          │
  │               │                ├─승인/보류/거절│
  │               │◀──처리────────┤                │
  │               │                │                │
  │  [승인 시]    │                │                │
  │               ├─[DB] PROCESSING│                │
  │               │                │                │
  │               │  [배치 14:00]  │                │
  │               │────────────────│──이체 요청───→│
  │               │◀───────────────│◀──이체 결과───┤
  │               │                │                │
  │               ├─[DB] COMPLETED │                │
  │◀──입금 알림──┤                │                │
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | 출금 신청 | 테스터 요청 | 잔액≥amount, amount≥10000, 일한도 | **UPDATE users** SET pointBalance -= amount; **INSERT withdrawals** (testerId, method, bankCode, accountNumber, accountHolder, amount, status=REQUESTED, flagged, flagReason, requestedAt) |
| 2 | 이상 감지 | 생성 직후 | 5개 조건 체크 | **UPDATE withdrawals** SET flagged=true, flagReason (해당 시) |
| 3a | 승인 | 관리자 | - | **UPDATE withdrawals** SET status=PROCESSING, approvedBy, approvedAt |
| 3b | 보류 | 관리자 | 이상 감지 | **UPDATE withdrawals** SET status=ON_HOLD, holdReason; **INSERT notifications** (테스터에게 보류 안내) |
| 3c | 거절 | 관리자 | - | **UPDATE withdrawals** SET status=REJECTED, rejectReason; **UPDATE users** SET pointBalance += amount; **INSERT reward_histories** (type=WITHDRAWAL_REFUND) |
| 4 | 배치 이체 | 스케줄러 14:00 | status=PROCESSING | 외부 은행 API 호출 |
| 5a | 이체 성공 | 은행 응답 | - | **UPDATE withdrawals** SET status=COMPLETED, completedAt; **INSERT notifications** (테스터 입금 알림) |
| 5b | 이체 실패 | 은행 응답 | - | **UPDATE withdrawals** SET status=FAILED, failReason; **INSERT notifications** (관리자+테스터 알림) |

## 생성되는 데이터 엔티티

| 엔티티 | 생성 시점 | 비고 |
|--------|----------|------|
| **withdrawals** | 출금 신청 시 | 출금 요청 이력 |
| **bank_accounts** | 최초 출금 시 | 테스터 계좌 정보 (암호화) |

---

# BP-07. 구독/결제 프로세스

## 시퀀스

```
개발자           서버              PG(토스)
  │               │                │
  ├─플랜 선택───→│                │
  │               │                │
  ├─결제 수단───→│                │
  │  등록         │                │
  │               ├─SDK 결제창───→│
  │               │                │
  │  ◀──결제────→│                │
  │               │                │
  │               ├─결제 승인 요청│
  │               │───────────────→│
  │               │◀──승인 결과───┤
  │               │                │
  │               ├─[DB] 구독 생성│
  │◀──완료────────┤                │
  │               │                │
  │  [매월 결제일]│                │
  │               │───정기결제───→│
  │               │◀──결과────────┤
  │               ├─[DB] 갱신     │
```

## 단계별 데이터 변화

| # | 단계 | 트리거 | 조건 | 데이터 변화 |
|---|------|--------|------|------------|
| 1 | 결제 수단 등록 | 카드/간편결제 | PG 인증 완료 | **INSERT payment_methods** (userId, type, billingKey, last4, expiryMonth, expiryYear, isDefault) |
| 2 | 구독 생성 | 플랜 선택 + 결제 | 결제 성공 | **INSERT subscriptions** (userId, plan, price, startDate, nextBillingDate, billingKey, status=ACTIVE); **INSERT payments** (type=SUBSCRIPTION, subscriptionId); **UPDATE users** SET currentPlan |
| 3 | 월간 자동 결제 | 스케줄러 | 결제일 도래 | **INSERT payments** (자동결제 이력); **UPDATE subscriptions** SET nextBillingDate += 1month |
| 4a | 업그레이드 | 즉시 | 차액 결제 | **UPDATE subscriptions** SET plan, price; **INSERT payments** (차액); **UPDATE users** SET currentPlan, remainingApps |
| 4b | 다운그레이드 | 다음 결제일 | - | **UPDATE subscriptions** SET pendingPlan={newPlan}; 결제일에 plan 변경 |
| 5 | 해지 | 사용자 요청 | - | **UPDATE subscriptions** SET status=CANCELLING, cancelledAt; 결제일에 status=CANCELLED, user.currentPlan=FREE |
| 6 | 결제 실패 | PG 응답 | - | **UPDATE subscriptions** SET failCount += 1; 3회 실패 시 status=CANCELLED, user.currentPlan=FREE |

## 생성되는 데이터 엔티티

| 엔티티 | 생성 시점 | 비고 |
|--------|----------|------|
| **payment_methods** | 수단 등록 시 | 빌링키 저장 |
| **subscriptions** | 구독 시작 시 | 플랜 구독 상태 |
| **payments** | 결제 발생 시 | 모든 결제 이력 통합 |

---

# 전체 데이터 엔티티 목록 (ERD 입력)

## 핵심 엔티티

| # | 엔티티 | 설명 | 프로세스 출처 |
|---|--------|------|-------------|
| 1 | **users** | 사용자 (개발자+테스터+관리자) | BP-01 |
| 2 | **apps** | 등록된 앱 | BP-02 |
| 3 | **applications** | 테스트 지원 | BP-03 |
| 4 | **participations** | 테스트 참여 (실행 추적) | BP-03, BP-04 |
| 5 | **feedbacks** | 피드백 | BP-05 |
| 6 | **payments** | 결제 이력 | BP-02, BP-07 |
| 7 | **subscriptions** | 구독 | BP-07 |
| 8 | **withdrawals** | 출금 요청 | BP-06 |

## 보조 엔티티

| # | 엔티티 | 설명 | 프로세스 출처 |
|---|--------|------|-------------|
| 9 | **social_accounts** | 소셜 연동 (1:N) | BP-01 |
| 10 | **user_agreements** | 약관 동의 이력 | BP-01 |
| 11 | **refresh_tokens** | JWT Refresh Token | BP-01 |
| 12 | **nickname_histories** | 닉네임 변경 이력 | BP-01 |
| 13 | **app_images** | 앱 아이콘/스크린샷 | BP-02 |
| 14 | **app_feedback_items** | 앱별 피드백 항목 설정 | BP-02 |
| 15 | **categories** | 앱 카테고리 마스터 | BP-02 |
| 16 | **feedback_ratings** | 항목별 별점 | BP-05 |
| 17 | **bug_reports** | 버그 리포트 | BP-05 |
| 18 | **bug_report_images** | 버그 첨부 이미지 | BP-05 |
| 19 | **reward_histories** | 포인트 변동 이력 | BP-05, BP-06 |
| 20 | **credit_histories** | 크레딧 변동 이력 | BP-02, BP-05 |
| 21 | **trust_score_histories** | 신뢰도 변동 이력 | BP-04, BP-05 |
| 22 | **payment_methods** | 결제 수단 (빌링키) | BP-07 |
| 23 | **bank_accounts** | 출금 계좌 (암호화) | BP-06 |
| 24 | **notifications** | 알림 | 전체 |
| 25 | **notification_settings** | 알림 설정 | BP-01 |

## 관리자/CS 엔티티

| # | 엔티티 | 설명 |
|---|--------|------|
| 26 | **tickets** | 고객 문의 티켓 |
| 27 | **ticket_messages** | 문의 대화 메시지 |
| 28 | **ticket_attachments** | 문의 첨부파일 |
| 29 | **reports** | 신고 (사용자/앱) |
| 30 | **faqs** | FAQ |
| 31 | **notices** | 공지사항 |
| 32 | **admin_logs** | 관리자 액션 로그 |
| 33 | **user_warnings** | 사용자 경고 이력 |
| 34 | **email_logs** | 이메일 발송 이력 |

---

## 엔티티 간 관계 요약

```
users ─1:N─ apps (developerId)
users ─1:N─ applications (testerId)
users ─1:N─ participations (testerId)
users ─1:N─ feedbacks (testerId)
users ─1:N─ withdrawals (testerId)
users ─1:N─ social_accounts
users ─1:N─ refresh_tokens
users ─1:N─ payment_methods
users ─1:1─ notification_settings
users ─1:N─ subscriptions
users ─1:N─ bank_accounts
users ─1:N─ reward_histories
users ─1:N─ credit_histories
users ─1:N─ trust_score_histories
users ─1:N─ notifications

apps ─1:N─ applications (appId)
apps ─1:N─ participations (appId)
apps ─1:N─ feedbacks (appId)
apps ─1:N─ app_images (appId)
apps ─1:N─ app_feedback_items (appId)
apps ─N:1─ categories (categoryId)
apps ─1:N─ payments (appId, nullable)

applications ─1:0..1─ participations (동일 appId+testerId)

feedbacks ─1:N─ feedback_ratings
feedbacks ─1:0..1─ bug_reports
bug_reports ─1:N─ bug_report_images

tickets ─1:N─ ticket_messages
tickets ─1:N─ ticket_attachments
tickets ─N:1─ users (userId)

reports ─N:1─ users (reporterId)
reports ─N:0..1─ users (targetUserId, nullable)
reports ─N:0..1─ apps (targetAppId, nullable)
```

---

## 주요 데이터 흐름 요약

### 돈의 흐름 (결제 → 리워드 → 출금)

```
[개발자 결제]
  │
  ├─건별: 29,000/39,000원 → payments (type=ONE_TIME)
  ├─구독: 월 19,900~99,900원 → payments (type=SUBSCRIPTION)
  │
  ▼
[플랫폼 보유]
  │
  ├─수수료: 5~15% → 플랫폼 수익
  ├─리워드: rewardAmount × 완료 테스터 수
  │
  ▼
[테스터 포인트]
  │  users.pointBalance += rewardAmount
  │  reward_histories (EARNED)
  │
  ▼
[출금]
  │  users.pointBalance -= amount
  │  withdrawals (REQUESTED → COMPLETED)
  │  reward_histories (WITHDRAWN)
  │
  ▼
[테스터 계좌]
```

### 크레딧의 흐름

```
[테스터 활동]
  │  다른 앱 테스트 완료 → +20 크레딧
  │  피드백 제출 → +10 크레딧
  │  credit_histories (EARNED_TEST / EARNED_FEEDBACK)
  │
  ▼
[개발자 사용]
  │  앱 등록 (CREDIT_EXCHANGE) → -50 크레딧
  │  credit_histories (USED_REGISTER)
```

### 신뢰도의 흐름

```
[가입] trustScore = 50 (초기값)
  │
  ├─테스트 완료 → 재계산 (완료율 40% 가중)
  ├─이탈 → -10점 (이탈 30% 가중)
  ├─피드백 품질 → 품질 점수 (20% 가중)
  ├─활동 기간 → 보너스 (10% 가중)
  │
  ▼
[등급 결정]
  0~49: 브론즈 / 50~69: 실버 / 70~89: 골드 / 90~100: 다이아
```
