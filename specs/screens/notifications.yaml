# S-05: 알림 센터
# Version: 2.0

version: "2.0"

screen:
  id: S-05
  name: 알림 센터
  route: /notifications
  layout: list

data_requirements:
  - resource: notifications
    needs: [id, userId, type, title, message, isRead, createdAt, relatedId]
    filters: { userId: ":userId", page: "?page" }
    action: read, update

components:
  - id: notification_tabs
    type: tabs
    position: top
    function: 알림 필터 탭 (전체/읽지않음/읽음)
    data_source:
      tabs: [전체, 읽지않음, 읽음]

  - id: notification_list
    type: list
    position: main
    function: 알림 리스트 (제목, 메시지, 시간, 읽음 상태)
    data_source:
      resource: notifications

  - id: mark_all_read_button
    type: button
    position: top-right
    function: 전체 읽음 처리 버튼

  - id: empty_state
    type: empty
    position: main
    function: 알림 없을 때 빈 상태 표시
    data_source:
      message: "새로운 알림이 없습니다."

events:
  - trigger: 알림 클릭
    action: notifications.isRead → true, relatedId로 해당 화면 이동
    result: 알림 타입별 이동 (APPLICATION_APPROVED → /tester/participations/:id)

  - trigger: 전체 읽음 처리
    action: 읽지 않은 알림 모두 isRead → true
    result: 알림 목록 업데이트, 읽음 표시

  - trigger: 읽지않음 탭 선택
    action: notifications 필터링 (isRead: false)
    result: 읽지 않은 알림만 표시

  - trigger: 읽음 탭 선택
    action: notifications 필터링 (isRead: true)
    result: 읽은 알림만 표시

tests:
  - name: 알림 목록 초기 로드
    when: 페이지 접속
    then: [최근 알림 20개 표시, 읽지 않은 알림 강조 표시]

  - name: 알림 클릭 시 이동 (지원 승인)
    when: type=APPLICATION_APPROVED 알림 클릭
    then: [isRead → true, 내 테스트 현황 페이지 이동 (/tester/participations/:id)]

  - name: 전체 읽음 처리
    when: 전체 읽음 버튼 클릭
    then: [모든 알림 isRead → true, UI 업데이트]

  - name: 빈 상태 표시
    when: 알림이 0개
    then: [empty_state 표시, "새로운 알림이 없습니다." 메시지]

  - name: 알림 타입별 라우팅
    when: 알림 클릭 (type별 분기)
    then:
      - APPLICATION_APPROVED → /tester/participations/:participationId
      - TEST_STARTED → /tester/participations/:participationId
      - FEEDBACK_SUBMITTED → /developer/apps/:appId/feedbacks
      - REWARD_PAID → /tester/rewards
      - DROPOUT_WARNING → /tester/participations/:participationId
